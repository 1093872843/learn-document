# 创建脚手架

参考代码 [create-vue](https://github.com/vuejs/create-vue)

实际案例 [自制 vue 脚手架](../self-vue-cli/)

## 制作方案

- 方案一
  创建多个项目模板，通过用户的选择，拉取合适的模板下载到本地供用户使用，适用于内容固定的项目

- 方案二

  创建一个基础模板与多个可选择的配置模块文件，根据用户的选择，动态组合模块文件，通过操作文件读取写入生成一个合适的项目模板供用户使用,灵活性更高。

## 前提知识

### package.json 中的 bin

package.json 允许用户设置 bin 字段提供一个或多个可执行的文件。比如 create-vue 就是使用了

```json
  "bin": {
    "create-vue": "outfile.cjs"
  },
```

使得我们安装了 create-vue 后，就可以在控制台命令行中直接使用 `create-vue` 命令，而这个命令本质上是执行了`outfile.cjs`文件。

当我们使用 npm 或者 yarn 命令本地安装包时，如果该包的 package.json 文件有 bin 字段，就会在 node_modules 文件夹下面的 .bin 目录中复制 bin 字段链接的执行文件，这样我们就可以直接使用命令来执行相对应的执行文件。

### npm link

（可以理解为 npm publish 项目到本地并同时 npm install 全局环境）

软连接，通常用于测试，当我们正常开发一个第三方依赖的时候，如果需要测试，则需要经历构建=>发布=》安装=》本地测试等过程，这明显很复杂，如何不需要发布就能本地测试？为此 npm 提供了 link 功能。

当我们在项目 A 根目录下执行 npm link,他会全局创建一个符号链接指向该项目 A(功能类似 npm install -g <该包>)。由于是链接到全局，所以现在我们就可以在任意位置使用 A 依赖或者 A 中的 bin 命令，而不需要进行一系列复杂的发布操作。

### 如何与命令行交互

我们需要和用户进行交互从而得知用户需求什么项目，以下工具包可以完成该功能。

- prompts 命令行交互的工具，获取用户命令行输入。
- kolorist 命令行内容彩色输出的工具。
- zx 采用 js 脚本语言编写 bash 脚本并执行的工具，快速开发执行脚本。

## 实战（采用方案二）

1. 创建文件夹 self-vue-cli，并执行 npm init -y，快速创建项目。
2. 写入 bin 字段内容,并创建 index.js 脚本执行文件。内容如下

   ```json
       "bin": {
           "mycli": "index.js"
       },
   ```

   `/index.js`内容如下

   其中#!/usr/bin/env node 为声明语句，表明该文件使用 node 解析器执行

   ```js
   #!/usr/bin/env node
   console.log("hello mycli!");
   ```

3. 进入项目根目录控制台 执行 `npm link`命令
4. 这时已经可以全局使用 bin 中的命令了，控制台输入执行 `mycli` 测试，可以看到控制台输出"hello mycli!"。
5. 部署项目，其他项目安装该依赖后，可以直接使`mycli`命令。
6. 接下来就是具体如何动态组合模块了，这里有一个案例代码[自制 vue 脚手架](../self-vue-cli/)
